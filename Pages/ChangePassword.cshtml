@page
@model AceJob.Pages.ChangePasswordModel
@{
    ViewData["Title"] = "Change Password";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
      <div class="card shadow">
           <div class="card-header bg-primary text-white">
         <h4 class="mb-0"><i class="bi bi-key me-2"></i>Change Password</h4>
    </div>
    <div class="card-body">
         @if (!string.IsNullOrEmpty(Model.SuccessMessage))
 {
            <div class="alert alert-success">
   <i class="bi bi-check-circle me-2"></i>@Model.SuccessMessage
     </div>
   }

       @if (!string.IsNullOrEmpty(Model.ErrorMessage))
         {
        <div class="alert alert-danger">
          <i class="bi bi-exclamation-circle me-2"></i>@Model.ErrorMessage
             </div>
     }

        @if (Model.DaysUntilExpiry.HasValue && Model.DaysUntilExpiry.Value <= 14)
{
          <div class="alert alert-warning">
             <i class="bi bi-clock me-2"></i>
        Your password will expire in <strong>@Model.DaysUntilExpiry days</strong>.
        </div>
             }

          <form method="post">
                 <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

     <div class="mb-3">
          <label asp-for="ChangeModel.CurrentPassword" class="form-label"></label>
               <input type="password" asp-for="ChangeModel.CurrentPassword" class="form-control" />
     <span asp-validation-for="ChangeModel.CurrentPassword" class="text-danger"></span>
             </div>

       <hr class="my-4">

 <div class="mb-3">
         <label asp-for="ChangeModel.NewPassword" class="form-label"></label>
  <input type="password" asp-for="ChangeModel.NewPassword" class="form-control" id="newPassword" />
         <span asp-validation-for="ChangeModel.NewPassword" class="text-danger"></span>
     <div class="progress mt-2" style="height: 5px;">
      <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
      </div>
            <small id="passwordStrengthText" class="text-muted"></small>
          </div>

          <div class="mb-3">
    <label asp-for="ChangeModel.ConfirmPassword" class="form-label"></label>
    <input type="password" asp-for="ChangeModel.ConfirmPassword" class="form-control" id="confirmPassword" />
     <span asp-validation-for="ChangeModel.ConfirmPassword" class="text-danger"></span>
                   <div id="passwordMatch" class="mt-1"></div>
              </div>

           <div class="card bg-light mb-4">
   <div class="card-body py-2">
      <small class="text-muted">
         <strong>Password Requirements:</strong>
 <ul class="mb-0 mt-1">
       <li>Minimum 12 characters</li>
   <li>At least one lowercase letter (a-z)</li>
              <li>At least one uppercase letter (A-Z)</li>
        <li>At least one number (0-9)</li>
         <li>At least one special character</li>
             <li>Cannot be same as last 2 passwords</li>
       </ul>
  </small>
        </div>
       </div>

             <div class="d-grid gap-2">
    <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-check-lg me-2"></i>Change Password
  </button>
    <a href="/" class="btn btn-outline-secondary">Cancel</a>
    </div>
</form>
  </div>
       </div>
    </div>
    </div>
</div>

@section Scripts {
<script>
var newPasswordInput = document.getElementById('newPassword');
    var confirmPasswordInput = document.getElementById('confirmPassword');
    var strengthBar = document.getElementById('passwordStrength');
    var strengthText = document.getElementById('passwordStrengthText');
    var matchDiv = document.getElementById('passwordMatch');

    newPasswordInput.addEventListener('input', function() {
        var password = this.value;
        var strength = 0;

        var hasLength = password.length >= 12;
        var hasLower = /[a-z]/.test(password);
      var hasUpper = /[A-Z]/.test(password);
        var hasNumber = /[0-9]/.test(password);
        var hasSpecial = /[^a-zA-Z0-9]/.test(password);

        if (hasLength) strength += 20;
        if (hasLower) strength += 20;
        if (hasUpper) strength += 20;
        if (hasNumber) strength += 20;
        if (hasSpecial) strength += 20;

    strengthBar.style.width = strength + '%';
   strengthBar.className = 'progress-bar ';

        if (strength <= 40) {
            strengthBar.classList.add('bg-danger');
 strengthText.textContent = 'Weak';
            strengthText.className = 'text-danger';
        } else if (strength <= 60) {
            strengthBar.classList.add('bg-warning');
            strengthText.textContent = 'Fair';
     strengthText.className = 'text-warning';
        } else if (strength <= 80) {
          strengthBar.classList.add('bg-info');
     strengthText.textContent = 'Good';
         strengthText.className = 'text-info';
 } else {
    strengthBar.classList.add('bg-success');
  strengthText.textContent = 'Strong';
            strengthText.className = 'text-success';
        }

        checkPasswordMatch();
    });

    confirmPasswordInput.addEventListener('input', checkPasswordMatch);

    function checkPasswordMatch() {
   var newPass = newPasswordInput.value;
var confirmPass = confirmPasswordInput.value;

        if (confirmPass.length === 0) {
      matchDiv.innerHTML = '';
 } else if (newPass === confirmPass) {
            matchDiv.innerHTML = '<small class="text-success">Passwords match</small>';
        } else {
matchDiv.innerHTML = '<small class="text-danger">Passwords do not match</small>';
 }
    }
</script>
}
